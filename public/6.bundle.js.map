{"version":3,"sources":["webpack:///./app/js/storage.js","webpack:///./app/js/data/template.js","webpack:///./app/js/data/data.js"],"names":["Storage","spec","id","Object","freeze","put","document","caches","open","then","cache","Response","get","async","callback","response","match","Request","json","value","undefined","clear","cacheName","delete","deleted","getKeys","keys","usage","navigator","storage","estimate","getFileInfo","data","f","html","name","type","getUsage","console","log","quota","usageDetails","quotaInMib","Math","round","usageInMib","percentUsed","Data","frames","deleteData","handleFileSelect","evt","getElementById","classList","remove","stopPropagation","preventDefault","file","dataTransfer","files","reader","FileReader","onload","e","JSON","parse","target","result","forEach","stringify","onprogress","lengthComputable","percentLoaded","loaded","total","progress","render","readAsText","handleDragOver","add","dropEffect","handleDragLeave","renderTmpl","max","totalTime","exportData","template","content","fileName","contentType","a","DateTime","local","toMillis","createElement","Blob","href","URL","createObjectURL","download","click","connect","context","length","start","frame","v","push","Duration","fromMillis","timestamp","toFormat","load","dropZone","addEventListener","disconnect"],"mappings":"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","file":"6.bundle.js","sourcesContent":["export function Storage(spec = {}) {\r\n  let id = 0;\r\n\r\n  let put = function(document) {\r\n    caches.open('gaze').then((cache) => {\r\n      const options = {\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        }\r\n      }\r\n      cache.put('/gaze/' + id, new Response(document));\r\n      id = id + 1;\r\n    })\r\n  }\r\n\r\n  let get = async function(id, callback) {\r\n    const cache = await caches.open('gaze');\r\n    const response = await cache.match(new Request('/gaze/' + id));\r\n\r\n    if (response) {\r\n      response.json().then((value) => callback(value));\r\n    } else {\r\n      callback(undefined);\r\n    }\r\n  }\r\n\r\n  let clear = async function(cacheName, callback) {\r\n    caches.delete(cacheName).then((deleted) => callback(deleted));\r\n  }\r\n\r\n  let getKeys = async function(cacheName, callback) {\r\n    const cache = await caches.open(cacheName);\r\n    cache.keys().then((keys) => callback(keys));\r\n  }\r\n\r\n  let usage = function(callback) {\r\n    return navigator.storage.estimate();\r\n  }\r\n\r\n  return Object.freeze({\r\n    put,\r\n    get,\r\n    clear,\r\n    getKeys,\r\n    usage\r\n  })\r\n}\r\n","import {html} from 'lit-html';\r\n\r\nexport const template = (data) => html`\r\n  <div class=\"mdc-layout-grid\">\r\n    <div class=\"mdc-layout-grid__inner\">\r\n      <div class=\"mdc-layout-grid__cell--span-8\">\r\n        <div id=\"drop\">Import data</div>\r\n        <progress value=\"${data.progress}\" max=\"100\"></progress>\r\n        ${getFileInfo(data)}\r\n        <h2>Cache Content</h2>\r\n        <div>Frames: ${data.max}</div>\r\n        <div>Duration: ${data.totalTime}</div>\r\n        <h2>Storage usage</h2>\r\n        ${getUsage(data)}\r\n      </div>\r\n      <div class=\"mdc-layout-grid__cell--span-4\">\r\n        <button @click=\"${data.exportData}\" class=\"mdc-button mdc-button--unelevated record-button\">\r\n          <span class=\"mdc-button__label\">Export</span>\r\n        </button>\r\n        <button @click=\"${data.deleteData}\" class=\"mdc-button mdc-button--unelevated record-button\">\r\n          <span class=\"mdc-button__label\">Clear</span>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n`;\r\n\r\nlet getFileInfo = function(data) {\r\n  if (!data.f) {\r\n    return html``\r\n  } else {\r\n    return html`\r\n      <div>Name: ${data.f.name}</div>\r\n      <div>Type: ${data.f.type}</div>\r\n    `\r\n  }\r\n}\r\n\r\nlet getUsage = function(data) {\r\n  console.log(\"getUsage\", data);\r\n\r\n  if (!data.usage) {\r\n    return html``\r\n  } else {\r\n    const { quota, usage, usageDetails } = data.usage;\r\n\r\n    const quotaInMib = Math.round(quota / (1024 * 1024));\r\n    const usageInMib = Math.round(usage / (1024 * 1024));\r\n    const percentUsed = Math.round(usage / quota * 100);\r\n\r\n    return html`\r\n      <div>Quota: ${quotaInMib} Mib</div>\r\n      <div>Usage: ${usageInMib} Mib (${percentUsed}%)</div>\r\n    `\r\n  }\r\n}\r\n","import {Storage} from '../storage.js';\r\n\r\nimport {render as renderTmpl} from 'lit-html';\r\nimport {DateTime, Duration} from 'luxon';\r\n\r\nimport {template} from './template.js'\r\n\r\nexport function Data(spec) {\r\n  let storage = Storage({});\r\n  let frames = [];\r\n\r\n  function download(content, fileName, contentType) {\r\n    var a = document.createElement(\"a\");\r\n    var file = new Blob([content], {type: contentType});\r\n    a.href = URL.createObjectURL(file);\r\n    a.download = fileName;\r\n    a.click();\r\n  }\r\n\r\n  let exportData = function() {\r\n    download(JSON.stringify(frames), 'experiment' + DateTime.local().toMillis() + '.json', 'text/json');\r\n    console.log(frames);\r\n  }\r\n\r\n  let deleteData = function() {\r\n    storage.clear(\"gaze\", (deleted) => {\r\n      console.log(\"cache deleted\", deleted);\r\n    });\r\n  }\r\n\r\n  let load = function(start) {\r\n    for (let frame=start; frame <= spec.max; frame++) {\r\n      storage.get(frame, (v) => {\r\n        if (v) {\r\n          frames.push(v);\r\n          //console.log(frames.length);\r\n          if (frames.length === spec.max) {\r\n            spec.totalTime = Duration.fromMillis((frames[spec.max-1].timestamp - frames[0].timestamp)).toFormat(\"hh:mm:ss\");\r\n            render(spec);\r\n            console.log(\"max reached\");\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  let handleFileSelect = function(evt) {\r\n    document.getElementById('drop').classList.remove('dragover');\r\n    console.log(\"file dropped\", evt);\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n\r\n    let files = evt.dataTransfer.files; // FileList object.\r\n    let file = files[0];\r\n    spec.f = file;\r\n\r\n    let reader = new FileReader();\r\n\r\n    reader.onload = function(e) {\r\n      console.log(\"file loaded\", e);\r\n      const data = JSON.parse(e.target.result);\r\n      deleteData();\r\n      data.forEach((document, id) => {\r\n        caches.open('gaze').then((cache) => {\r\n          const options = {\r\n            headers: {\r\n              'Content-Type': 'application/json'\r\n            }\r\n          }\r\n          cache.put('/gaze/' + id, new Response(JSON.stringify(document)));\r\n        })\r\n      })\r\n    }\r\n    reader.onprogress = function(e) {\r\n      if (e.lengthComputable) {\r\n        const percentLoaded = Math.round((e.loaded / e.total) * 100);\r\n        console.log(percentLoaded);\r\n        spec.progress = percentLoaded;\r\n        render(spec);\r\n      }\r\n    }\r\n\r\n    reader.readAsText(file);\r\n    render(spec);\r\n  }\r\n\r\n  let handleDragOver = function(evt) {\r\n    document.getElementById('drop').classList.add('dragover');\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n    evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.\r\n  }\r\n\r\n  let handleDragLeave = function(evt) {\r\n    document.getElementById('drop').classList.remove('dragover');\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n  }\r\n\r\n  let render = data => {\r\n    renderTmpl(template(data), document.getElementById('view'));\r\n  }\r\n\r\n  let init = () => {\r\n    Object.assign(spec, {\r\n      max: 1000,\r\n      exportData,\r\n      deleteData\r\n    });\r\n    render(spec);\r\n  }\r\n\r\n  init();\r\n\r\n  let connect = async function(context) {\r\n    render(spec);\r\n    const usage = await storage.usage();\r\n    console.log(\"usage\", usage);\r\n    spec.usage = usage;\r\n    storage.getKeys(\"gaze\", (keys) => {\r\n      spec.max = keys.length;\r\n      render(spec);\r\n      console.log(\"max\", spec.max);\r\n      load(0);\r\n    });\r\n\r\n    // Setup the dnd listeners.\r\n    let dropZone = document.getElementById('drop');\r\n    dropZone.addEventListener('dragover', handleDragOver, false);\r\n    dropZone.addEventListener('dragleave', handleDragLeave, false);\r\n    dropZone.addEventListener('drop', handleFileSelect, false);\r\n  }\r\n\r\n  let disconnect = function() {\r\n    console.log(\"disconnect from data\");\r\n  }\r\n\r\n  return Object.freeze({\r\n    connect,\r\n    disconnect\r\n  });\r\n}\r\n"],"sourceRoot":""}