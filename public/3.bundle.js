(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{10:function(t,e,n){"use strict";function i(t={}){return Object.freeze({relative:function(t,e,n){return(e-t)/(n-t)},limit:function(t,e,n){return e<t?t:e>n?n:e},normalize:function(t,e,n){return t<e&&(t=e),t>n&&(t=n),(t-e)/(n-e)}})}n.d(e,"a",(function(){return i}))},11:function(t,e,n){"use strict";n.d(e,"d",(function(){return r})),n.d(e,"e",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return c})),n.d(e,"c",(function(){return u}));var i=n(9);const r=10,o=5;function a(t={x:0,y:0,t:0}){let{x:e,y:n,t:i}=t;return Object.freeze({getX:function(){return e},getY:function(){return n},getTimestamp:function(){return i}})}function c(t={x:0,y:0,t:0,d:0}){let{x:e,y:n,t:i,d:r}=t;return Object.freeze({getX:function(){return e},getY:function(){return n},getTimestamp:function(){return i},getDuration:function(){return r},getFixation:function(){return{x:e,y:n}}})}function u(t={points:[]}){let{points:e}=t;return Object.freeze({detector:function(){return function(){let t=e.map(t=>t.getX()*i.c),n=e.map(t=>t.getY()*i.b);return Math.max(...t)-Math.min(...t)+(Math.max(...n)-Math.min(...n))}()>50&&function(){let t=e.map(t=>t.getX()),n=e.map(t=>t.getY());return c({x:+(t.reduce((t,e)=>t+e)/t.length).toFixed(6),y:+(n.reduce((t,e)=>t+e)/n.length).toFixed(6),t:+e[0].getTimestamp().toFixed(6),d:+(e[e.length-1].getTimestamp()-e[0].getTimestamp()).toFixed(6)})}()}})}},14:function(t,e,n){"use strict";function i(t={}){let e=0;return Object.freeze({put:function(t){caches.open("gaze").then(n=>{n.put("/gaze/"+e,new Response(t)),e+=1})},get:async function(t,e){const n=await caches.open("gaze"),i=await n.match(new Request("/gaze/"+t));i?i.json().then(t=>e(t)):e(void 0)},clear:async function(t,e){caches.delete(t).then(t=>e(t))},getKeys:async function(t,e){(await caches.open(t)).keys().then(t=>e(t))},usage:function(t){return navigator.storage.estimate()}})}n.d(e,"a",(function(){return i}))},27:function(t,e){},67:function(t,e,n){"use strict";function i(){return(i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}t.exports=function(t,e,n,c,f,s){if(!o(t)||!o(e)||n&&!o(n))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(t.length!==e.length||n&&n.length!==t.length)throw new Error("Image sizes do not match.");if(t.length!==c*f*4)throw new Error("Image data size does not match width/height.");s=i({},r,s);const l=c*f,d=new Uint32Array(t.buffer,t.byteOffset,l),m=new Uint32Array(e.buffer,e.byteOffset,l);let p=!0;for(let t=0;t<l;t++)if(d[t]!==m[t]){p=!1;break}if(p){if(n&&!s.diffMask)for(let e=0;e<l;e++)g(t,4*e,s.alpha,n);return 0}const y=35215*s.threshold*s.threshold;let w=0;for(let i=0;i<f;i++)for(let r=0;r<c;r++){const o=4*(i*c+r),l=u(t,e,o,o);Math.abs(l)>y?s.includeAA||!a(t,r,i,c,f,e)&&!a(e,r,i,c,f,t)?(n&&h(n,o,...l<0&&s.diffColorAlt||s.diffColor),w++):n&&!s.diffMask&&h(n,o,...s.aaColor):n&&(s.diffMask||g(t,o,s.alpha,n))}return w};const r={threshold:.1,includeAA:!1,alpha:.1,aaColor:[255,255,0],diffColor:[255,0,0],diffColorAlt:null,diffMask:!1};function o(t){return ArrayBuffer.isView(t)&&1===t.constructor.BYTES_PER_ELEMENT}function a(t,e,n,i,r,o){const a=Math.max(e-1,0),f=Math.max(n-1,0),s=Math.min(e+1,i-1),l=Math.min(n+1,r-1),d=4*(n*i+e);let h,g,m,p,y=e===a||e===s||n===f||n===l?1:0,w=0,b=0;for(let r=a;r<=s;r++)for(let o=f;o<=l;o++){if(r===e&&o===n)continue;const a=u(t,t,d,4*(o*i+r),!0);if(0===a){if(y++,y>2)return!1}else a<w?(w=a,h=r,g=o):a>b&&(b=a,m=r,p=o)}return 0!==w&&0!==b&&(c(t,h,g,i,r)&&c(o,h,g,i,r)||c(t,m,p,i,r)&&c(o,m,p,i,r))}function c(t,e,n,i,r){const o=Math.max(e-1,0),a=Math.max(n-1,0),c=Math.min(e+1,i-1),u=Math.min(n+1,r-1),f=4*(n*i+e);let s=e===o||e===c||n===a||n===u?1:0;for(let r=o;r<=c;r++)for(let o=a;o<=u;o++){if(r===e&&o===n)continue;const a=4*(o*i+r);if(t[f]===t[a]&&t[f+1]===t[a+1]&&t[f+2]===t[a+2]&&t[f+3]===t[a+3]&&s++,s>2)return!0}return!1}function u(t,e,n,i,r){let o=t[n+0],a=t[n+1],c=t[n+2],u=t[n+3],h=e[i+0],g=e[i+1],m=e[i+2],p=e[i+3];if(u===p&&o===h&&a===g&&c===m)return 0;u<255&&(u/=255,o=d(o,u),a=d(a,u),c=d(c,u)),p<255&&(p/=255,h=d(h,p),g=d(g,p),m=d(m,p));const y=f(o,a,c),w=f(h,g,m),b=y-w;if(r)return b;const v=s(o,a,c)-s(h,g,m),x=l(o,a,c)-l(h,g,m),O=.5053*b*b+.299*v*v+.1957*x*x;return y>w?-O:O}function f(t,e,n){return.29889531*t+.58662247*e+.11448223*n}function s(t,e,n){return.59597799*t-.2741761*e-.32180189*n}function l(t,e,n){return.21147017*t-.52261711*e+.31114694*n}function d(t,e){return 255+(t-255)*e}function h(t,e,n,i,r){t[e+0]=n,t[e+1]=i,t[e+2]=r,t[e+3]=255}function g(t,e,n,i){const r=d(f(t[e+0],t[e+1],t[e+2]),n*t[e+3]/255);h(i,e,r,r,r)}},70:function(t,e,n){"use strict";n.r(e),n.d(e,"Replay",(function(){return l}));var i=n(14),r=n(9),o=n(11),a=n(8),c=(n(19),n(0)),u=(n(67),n(28));let f=function(){document.getElementById("a").getContext("2d").canvas.webkitRequestFullScreen()};function s(){return(s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function l(t){let e=void 0,n=Object(i.a)({}),l=Object(r.i)({x:0,y:0,width:1280,height:720}).tiles().map(t=>Object(r.i)(t)),d=Object(r.e)({tiles:l}),h=[],g=!1,m=function(){g=!g},p=void 0,y=void 0,w=o.e,b=void 0,v=Date.now(),x=1e3/w,O=void 0,j=function(){console.log("playing",t.playing),t.playing?cancelAnimationFrame(y):y=requestAnimationFrame(z),t.playing=!t.playing,M(t)},k=function(){return"background-image:-webkit-linear-gradient(left, #b91f1f "+t.position/t.max*100+"%, #a5a5a5 "+t.position/t.max*100+"%, #a5a5a5 "+(h.length+t.position)/t.max*100+"%, #757575 "+(h.length+t.position)/t.max*100+"%)"},A=function(){let e=t.position;if(t.position=+document.getElementById("seek").value,console.log(e,t.position),d.reset(),t.position<e)h=[],_(t.position);else if(t.position>e){let n=t.position-e;Array(n).fill().forEach((function(){h.shift()}))}M(t)},M=t=>{Object(c.b)((t=>c.a`
  <div class="mdc-layout-grid">
    <div class="mdc-layout-grid__inner">
      <div class="mdc-layout-grid__cell--span-8">
        <canvas @click="${f}" id="a" width="1280" height="720"></canvas>
        <div id="canvas-ctrl">
          <button @click="${t.play}" class="mdc-icon-button material-icons">${t.playing?c.a`stop`:c.a`play_arrow`}</button>
          <input id="seek" @input="${t.seek}" .value="${t.position}" max="${t.max}" type="range" style="${t.seekStyle}">
          <span id="time">${t.time}</span>
          <span id="total-time">&nbsp;/ ${t.totalTime}</span>
        </div>
      </div>
      <div class="mdc-layout-grid__cell--span-4">
        <div class="mdc-switch">
          <div class="mdc-switch__track"></div>
          <div class="mdc-switch__thumb-underlay">
            <div class="mdc-switch__thumb">
              <input @click="${t.showHeatmap}" type="checkbox" id="basic-switch" class="mdc-switch__native-control" role="switch">
            </div>
          </div>
        </div>
        <label for="basic-switch">Show Heatmap</label>
      </div>
    </div>
  </div>
`)({...t,seekStyle:k()}),document.getElementById("view"))};s(t,{playing:!1,position:0,time:"00:00:00",totalTime:"--:--:--",max:1e3,play:j,seek:A,seekStyle:k(),showHeatmap:m}),M(t);let z=function(){if(t.position===t.max)return console.log("no frame"),t.playing=!t.playing,t.position=0,_(t.position),t.time=u.Duration.fromMillis(0).toFormat("hh:mm:ss"),void M(t);if(b=Date.now(),O=b-v,O>x){v=b-O%x;let n=document.getElementById("a").getContext("2d"),i=h.shift();if(i){let c=Object(o.a)({x:i.x,y:i.y}),f=d.getCountArr(),s=new ArrayBuffer(8),l=new Float32Array(s);l[0]=c.getX(),l[1]=c.getY(),0!==d.getCountArr().buffer.length&&C.postMessage({count:f,gaze:s},[f.buffer,s]);let h=new Image;h.onload=function(){n.drawImage(h,0,0,1280,720),Object(r.a)({x:c.getX(),y:c.getY(),r:20}).render(n,a.c),e&&Object(r.f)({x1:e.getX(),y1:e.getY(),x2:c.getX(),y2:c.getY()}).render(n,a.e),e=c,g&&d.render(n),t.time=u.Duration.fromMillis(i.timestamp-p).toFormat("hh:mm:ss"),t.position++},h.src=i.img}M(t)}y=requestAnimationFrame(z)},_=function(e){for(let i=e;i<=t.max;i++)n.get(i,e=>{e&&(h.push(e),h.length===t.max&&(t.totalTime=u.Duration.fromMillis(h[t.max-1].timestamp-h[0].timestamp).toFormat("hh:mm:ss"),p=h[0].timestamp),M(t))})},C=void 0;return Object.freeze({connect:function(e){e=e,Object(r.i)({x:0,y:0,width:e.canvas.width,height:e.canvas.height}).clear(e),C=new Worker("/heatmap.js"),C.onmessage=function(t){d.setCountArr(t.data)},C.onerror=function(t){console.log("onerror",t)},n.getKeys("gaze",e=>{t.max=e.length,console.log("max",t.max),_(0)})},disconnect:function(){console.log("disconnect from replay")}})}},8:function(t,e,n){"use strict";n.d(e,"d",(function(){return r})),n.d(e,"c",(function(){return o})),n.d(e,"e",(function(){return a})),n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return y}));var i=n(10);const r="rgba(200,0,0,0.85)",o="rgba(255,255,255,0.85)",a="rgba(255,255,255,0.85)",c="rgb(0,0,0)",u=[],f=[];for(var s=0;s<10;s++){var l=.618033988749895*s%1,d=Math.sqrt(1-.618033988749895*s%.5),h=[g=l,(m=.5)*(p=d)/((g=(2-m)*p)<1?g:2-g),g/2];u.push("hsla("+Math.round(255*h[0])+","+Math.round(100*h[1])+"%,"+Math.round(100*h[2])+"%,0.5)")}var g,m,p;for(let t=0;t<210;t++)f.push("hsla("+(209-t)+", 50%, 50%,0.5)");function y(t={}){let e=Object(i.a)({});return Object.freeze({heat:function(t){let n=e.limit(0,t,1);return 0===t?"rgba(0,0,0,0)":f[Math.round(n*(f.length-1))]}})}},9:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"g",(function(){return f})),n.d(e,"h",(function(){return s})),n.d(e,"f",(function(){return l})),n.d(e,"a",(function(){return d})),n.d(e,"i",(function(){return g})),n.d(e,"e",(function(){return m})),n.d(e,"d",(function(){return p}));var i=n(8),r=n(10);const o=window.screen.width*window.devicePixelRatio,a=window.screen.height*window.devicePixelRatio;let c=Object(i.b)({}),u=Object(r.a)({});function f(t={x:0,y:0}){let{x:e,y:n}=t;return Object.freeze({getX:function(){return e},getY:function(){return n},render:function(t,i){t.fillStyle=i,t.fillRect(e*t.canvas.width,n*t.canvas.height,.005*t.canvas.width,.005*t.canvas.width)}})}function s(t={points:[]}){let{points:e}=t;return Object.freeze({render:function(t,n){t.fillStyle=n,e.forEach((function(e){e.render(t,n)}))},renderTimeline:function(t,n,i){t.fillStyle=i,e.forEach((function(e,i){let r=0===n?e.getX():e.getY();t.fillRect(i/30*t.canvas.width,(1-r)*t.canvas.height,t.canvas.width/30,1)}))}})}function l(t={x1:0,y1:0,x2:0,y2:0}){let{x1:e,y1:n,x2:i,y2:r}=t;return Object.freeze({render:function(t,o){t.strokeStyle=o,t.beginPath(),t.moveTo(e*t.canvas.width,n*t.canvas.height),t.lineTo(i*t.canvas.width,r*t.canvas.height),t.stroke()}})}function d(t={x:0,y:0,r:0}){let{x:e,y:n,r:i}=t;return Object.freeze({getX:function(){return e},getY:function(){return n},getR:function(){return i},render:function(t,r,o){t.beginPath(),t.arc(e*t.canvas.width,n*t.canvas.height,i,0,2*Math.PI),o&&(t.fillStyle=o,t.fill()),r&&(t.strokeStyle=r,t.stroke())}})}const h=[30,15];function g(t={x:0,y:0,width:0,height:0}){let{x:e,y:n,width:r,height:o}=t;return Object.freeze({getX:function(){return e},getY:function(){return n},getWidth:function(){return r},getHeight:function(){return o},clear:function(t,e){t.fillStyle=e||i.a,t.fillRect(0,0,r,o)},tiles:function(t=h){let i=[],a={x:e,y:n},c=!1;for(;a.y<n+o;){let n={x:a.x,y:a.y,width:t[0],height:t[1]};i.push(n),a.x=n.x+n.width,a.x>=e+r&&(c=!c,a.y+=t[1],a.x=c?e-t[0]/2:0)}return i},containsPoint:function(t,i){let a=r,c=o;return!((a|c)<0)&&(!(t<e||i<n)&&(a+=e,c+=n,(a<e||a>t)&&(c<n||c>i)))},render:function(t,i,a){i&&(t.strokeStyle=i,t.strokeRect(e,n,r,o)),a&&(t.fillStyle=a,t.fillRect(e,n,r,o))}})}function m(t={tiles:[]}){let{tiles:e}=t,n=new Uint16Array(new ArrayBuffer(2*e.length)),i=new Uint16Array(new ArrayBuffer(2*e.length));return Object.freeze({getCount:function(t){return n[t]},setCount:function(t,e){n[t]=e},getCountArr:function(){return n},setCountArr:function(t){n=t},reset:function(){n=new Uint16Array(new ArrayBuffer(2*e.length)),i=new Uint16Array(new ArrayBuffer(2*e.length))},render:function(t){let r=0!==n.buffer.byteLength?n:i,o=Math.max(...r);0!==o&&e.forEach((function(e,n){if(r[n]){let i=c.heat(u.relative(0,r[n],o));e.render(t,void 0,i)}})),0!==n.buffer.byteLength&&(i=n.slice(0))}})}function p(t={}){return Object.freeze({linear:function(t,e,n,i){return(n-e)*t/i+e}})}}}]);
//# sourceMappingURL=3.bundle.js.map